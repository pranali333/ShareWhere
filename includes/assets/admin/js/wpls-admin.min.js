/* 
 * WordPress Location Share 
 * @package WPLS 
 */
var wpls_object,initialLocation,browserSupportFlag=new Boolean,marker,geocoder,infowindow,wpls_magnific_popup;!function(a){wpls_object={init:function(){wpls_object.wpls_load_google_map()},wpls_load_google_map:function(){a("#wp-location-share-map").magnificPopup({type:"inline",modal:!1,callbacks:{open:function(){wpls_object.wpls_google_map_intialize()}}}),wpls_magnific_popup=a.magnificPopup.instance},wpls_google_map_intialize:function(){var a=new google.maps.LatLng(18.5204393,73.8567347),b={zoom:17,mapTypeId:google.maps.MapTypeId.ROADMAP,streetViewControl:!1},c=new google.maps.Map(document.getElementById("wpls-google-map"),b);navigator.geolocation?(browserSupportFlag=!0,navigator.geolocation.getCurrentPosition(function(a){wpls_object.wpls_markOutLocation(c,a.coords.latitude,a.coords.longitude)},function(){wpls_object.wpls_handle_no_geo_location(browserSupportFlag,a)})):(browserSupportFlag=!1,wpls_object.wpls_handle_no_geo_location(browserSupportFlag,a)),wpls_object.wpls_search_google_map(c)},wpls_handle_no_geo_location:function(a,b){1==a?(alert("Geolocation service failed."),initialLocation=b):(alert("Your browser doesn't support geolocation. We've placed you in Pune, India."),initialLocation=b),map.setCenter(initialLocation)},wpls_markOutLocation:function(a,b,c){geocoder=new google.maps.Geocoder,infowindow=new google.maps.InfoWindow;var d=new google.maps.LatLng(b,c);geocoder.geocode({location:d},function(b,c){c==google.maps.GeocoderStatus.OK?b[1]?(a.setCenter(d,17),marker=new google.maps.Marker({position:d,draggable:!0,map:a}),infowindow.setContent(b[1].formatted_address),infowindow.open(a,marker),wpls_object.wpls_store_location(b[1].formatted_address),google.maps.event.addListener(marker,"dragend",function(b){wpls_object.wpls_geocodePosition(a,marker.getPosition())}),google.maps.event.addListener(marker,"click",function(b){wpls_object.wpls_geocodePosition(a,marker.getPosition())}),google.maps.event.addListener(a,"click",function(b){wpls_object.wpls_geocodePosition(a,b.latLng)})):window.alert("No results found"):window.alert("Geocoder failed due to: "+c)})},wpls_geocodePosition:function(a,b){geocoder.geocode({latLng:b},function(c){c&&c.length>0?(marker.formatted_address=c[0].formatted_address,wpls_object.wpls_store_location(marker.formatted_address)):marker.formatted_address="Cannot determine address at this location.",a.setCenter(b,17),marker.setPosition(b),infowindow.setContent(marker.formatted_address),infowindow.open(a,marker)})},wpls_search_google_map:function(a){var b=document.getElementById("wpls-map-search"),c=new google.maps.places.Autocomplete(b);c.bindTo("bounds",a),google.maps.event.addListener(c,"place_changed",function(){var b=c.getPlace();if(!b.geometry)return void window.alert("Autocomplete's returned place contains no geometry");var d=b.geometry.location.G,e=b.geometry.location.K,f=new google.maps.LatLng(d,e);wpls_object.wpls_geocodePosition(a,f)})},wpls_store_location:function(b){a("#wpls-store-location").val(b)},wpls_append_location:function(){var b=a("#wpls-store-location").val(),c='<a title="'+b+'" href="https://google.com/maps?q='+decodeURIComponent(b)+'" target="_blank">'+b+"</a>";a(c).appendTo(a("#wp-content-editor-container iframe").contents().find("body")),wpls_magnific_popup.close()}},a("document").ready(function(){wpls_object.init(),a("#wpls-insert-button").click(function(){wpls_object.wpls_append_location()})})}(jQuery);