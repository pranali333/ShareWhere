/* 
 * WordPress Location Share 
 * @package WPLS 
 */
var wpls_object,initialLocation,browserSupportFlag=new Boolean,marker,geocoder,infowindow,wpls_magnific_popup,wpls_location_types=new Array;!function(a){wpls_object={init:function(){wpls_object.wpls_load_google_map()},wpls_load_google_map:function(){a("#wp-location-share-map").magnificPopup({type:"inline",modal:!1,callbacks:{open:function(){wpls_object.wpls_google_map_intialize()}}}),wpls_magnific_popup=a.magnificPopup.instance},wpls_google_map_intialize:function(){a("#wpls-location-type").removeClass("wpls-location-type-error");var b=new google.maps.LatLng(18.5204393,73.8567347),c={zoom:17,mapTypeId:google.maps.MapTypeId.ROADMAP,streetViewControl:!1},d=new google.maps.Map(document.getElementById("wpls-google-map"),c);navigator.geolocation?(browserSupportFlag=!0,navigator.geolocation.getCurrentPosition(function(a){wpls_object.wpls_markOutLocation(d,a.coords.latitude,a.coords.longitude)},function(){wpls_object.wpls_handle_no_geo_location(browserSupportFlag,b)})):(browserSupportFlag=!1,wpls_object.wpls_handle_no_geo_location(browserSupportFlag,b)),wpls_object.wpls_search_google_map(d)},wpls_handle_no_geo_location:function(a,b){1==a?(alert(wpls_admin_strings.wpls_geolocation_service_failed),initialLocation=b):(alert(wpls_admin_strings.wpls_geolocation_not_supported_browser),initialLocation=b),map.setCenter(initialLocation)},wpls_markOutLocation:function(a,b,c){geocoder=new google.maps.Geocoder,infowindow=new google.maps.InfoWindow;var d=new google.maps.LatLng(b,c);geocoder.geocode({location:d},function(b,c){c==google.maps.GeocoderStatus.OK?b[1]?(a.setCenter(d,17),marker=new google.maps.Marker({position:d,draggable:!0,map:a}),infowindow.setContent(b[0].formatted_address),infowindow.open(a,marker),wpls_object.wpls_store_location(b[0]),google.maps.event.addListener(marker,"dragend",function(b){wpls_object.wpls_geocodePosition(a,marker.getPosition())}),google.maps.event.addListener(marker,"click",function(b){wpls_object.wpls_geocodePosition(a,marker.getPosition())}),google.maps.event.addListener(a,"click",function(b){wpls_object.wpls_geocodePosition(a,b.latLng)})):window.alert(wpls_admin_strings.wpls_no_result_found):window.alert(wpls_admin_strings.wpls_geocoder_failed+" "+c)})},wpls_geocodePosition:function(a,b){geocoder.geocode({latLng:b},function(c){c&&c.length>0?(marker.formatted_address=c[0].formatted_address,wpls_object.wpls_store_location(c[0])):marker.formatted_address=wpls_admin_strings.wpls_not_determine_location,a.setCenter(b,17),marker.setPosition(b),infowindow.setContent(marker.formatted_address),infowindow.open(a,marker)})},wpls_search_google_map:function(a){var b=document.getElementById("wpls-map-search"),c=new google.maps.places.Autocomplete(b);c.bindTo("bounds",a),google.maps.event.addListener(c,"place_changed",function(){var b=c.getPlace();if(!b.geometry)return void window.alert(wpls_admin_strings.wpls_autocomplete_no_geometry);var d=b.geometry.location.G,e=b.geometry.location.K,f=new google.maps.LatLng(d,e);wpls_object.wpls_geocodePosition(a,f)})},wpls_store_location:function(b){for(var c,d,e,f=0;f<b.address_components.length;f++)"locality"==b.address_components[f].types[0]?c=b.address_components[f]:"administrative_area_level_1"==b.address_components[f].types[0]?d=b.address_components[f]:"country"==b.address_components[f].types[0]&&(e=b.address_components[f]);a("#wpls-city").val(c.long_name),a("#wpls-state").val(d.long_name),a("#wpls-country").val(e.long_name),a("#wpls-store-location").val(b.formatted_address)},wpls_append_location:function(b){if(""==b){var c=confirm(wpls_admin_strings.wpls_full_address_confirmation);if(!c)return void a("#wpls-location-type").addClass("wpls-location-type-error");b="full",a("#wpls-location-type").removeClass("wpls-location-type-error")}var d=wpls_object.wpls_final_location(b),e="<a title='"+d+"' href='https://google.com/maps?q="+decodeURIComponent(d)+"' target='_blank'>"+d+"</a>";if("undefined"!=typeof tinymce){var f=tinymce.get("content");if(f&&f instanceof tinymce.Editor){var g=f.getContent();f.setContent(g+" "+e),f.save({no_events:!0})}else jQuery("textarea#content").val(jQuery("textarea#content").val()+" "+e)}a("#wpls-location-type").val(""),wpls_magnific_popup.close()},wpls_final_location:function(b){var c=a("#wpls-city").val(),d=a("#wpls-state").val(),e=a("#wpls-country").val(),f=a("#wpls-store-location").val();return wpls_location_types.city=c,wpls_location_types.state=d,wpls_location_types.country=e,wpls_location_types["city-state"]=c+", "+d,wpls_location_types["city-country"]=c+", "+e,wpls_location_types["state-country"]=d+", "+e,wpls_location_types["city-state-country"]=c+", "+d+", "+e,wpls_location_types.full=f,wpls_location_types[b]}},a("document").ready(function(){wpls_object.init(),a("#wpls-insert-button").click(function(){var b=a("#wpls-location-type").val();wpls_object.wpls_append_location(b)})})}(jQuery);